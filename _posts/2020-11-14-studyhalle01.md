---
layout: post
title: "[ìŠ¤í„°ë””í• ë˜ 01] JVMì€ ë¬´ì—‡ì´ë©° ìë°” ì½”ë“œëŠ” ì–´ë–»ê²Œ ì‹¤í–‰í•˜ëŠ” ê²ƒì¸ê°€"
author: "Hongmin Park"
tags: java
---
*ì´ ê¸€ì€ 'ë°±ê¸°ì„ ' ê°œë°œìë‹˜ê³¼ í•¨ê»˜í•˜ëŠ” ì˜¨ë¼ì¸ ìë°” ìŠ¤í„°ë””ì— ì°¸ì—¬í•˜ì—¬ ì¤€ë¹„/í•™ìŠµí•œ ë‚´ìš©ì„ ì •ë¦¬í•˜ëŠ” ê¸€ì…ë‹ˆë‹¤.ğŸ“š*
- 1ì£¼ì°¨ : https://github.com/whiteship/live-study/issues/1
- ëª©í‘œ : ìë°” ì†ŒìŠ¤ íŒŒì¼(.java)ì„ JVMìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ê³¼ì • ì´í•´í•˜ê¸°.

## JVMì´ë€ ë¬´ì—‡ì¸ê°€
ë‚˜ëŠ” ê³µì‹ë¬¸ì„œë¥¼ ì¢‹ì•„í•´ì„œ, [ì˜¤ë¼í´ Java SE 8 ê³µì‹ë¬¸ì„œ](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-1.html)ë¥¼ ì°¸ê³ í•´ì„œ ì •ë¦¬í•´ë³´ì•˜ë‹¤. 
- JVMì€ ìë°” í”Œë«í¼ì˜ ì£¼ì¶§ëŒì´ë‹¤. í•˜ë“œì›¨ì–´ë‚˜ OSì— ì¢…ì†ë˜ì§€ ì•Šê³  ì»´íŒŒì¼ëœ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŒì„ ë³´ì¥í•œë‹¤. 
- ì¶”ìƒì ì¸ ì»´í“¨íŒ… ë¨¸ì‹ ì´ë‹¤. ì‹¤ì œ ì»´í“¨íŒ… ë¨¸ì‹ ì²˜ëŸ¼ ëŸ°íƒ€ì„ì— ë©”ëª¨ë¦¬ë¥¼ ê´€ë¦¬í•˜ëŠ” ê¸°ìˆ ê³¼ instruction setì„ ê°–ê³  ìˆë‹¤.
- JVMì€ íŠ¹ì • êµ¬í˜„ ê¸°ìˆ ì„ ì˜ë¯¸í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤.
- JVMì€ ìë°” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì— ëŒ€í•´ì„œëŠ” ì•„ë¬´ ê²ƒë„ ëª¨ë¥¸ë‹¤. ë°”ì´í„°ë¦¬ í¬ë§·ì¸ `class` íŒŒì¼ë§Œ í•´ì„í•  ìˆ˜ ìˆë‹¤. 
- `class` íŒŒì¼ì—ëŠ” JVM [instructions](https://simple.wikipedia.org/wiki/Instruction_(computer_science)), [symbol table](https://ko.wikipedia.org/wiki/%EC%8B%AC%EB%B3%BC_%ED%85%8C%EC%9D%B4%EB%B8%94) ê°™ì€ ê²ƒë“¤ì´ í¬í•¨ë˜ì–´ ìˆë‹¤. 
- ì–´ë–¤ ì–¸ì–´ë“  ìœ íš¨í•œ `class` íŒŒì¼ë¡œ ì‘ì„±ë˜ë©´ JVMì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ [Jython](https://www.jython.org/)ì€ íŒŒì´ì¬ ì–¸ì–´ë¡œ ì‘ì„±í•œ í”„ë¡œê·¸ë¨ì„ JVMì—ì„œ ì‹¤í–‰í•œë‹¤. 

## ì»´íŒŒì¼ í•˜ëŠ” ë°©ë²•
- ëŒ€ê²Œ ì¼ë°˜ì¸ì´ ì‘ì„±í•˜ëŠ” java/pythonê³¼ ê°™ì€ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ëŠ” ì»´í“¨í„°ê°€ ë°”ë¡œ ì´í•´í•  ìˆ˜ ì—†ë‹¤. ì‰½ê²Œ ìƒê°í•˜ë©´, ì»´í“¨í„°ê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ì–¸ì–´ë¡œ ë°”ê¿” ì£¼ëŠ” ê³¼ì •ì´ ì»´íŒŒì¼ì´ë‹¤.
- ìë°”ì—ì„œëŠ” `.java`ë¥¼ `.class` íŒŒì¼ë¡œ ì»´íŒŒì¼í•œë‹¤.
- ì¼ë°˜ì ìœ¼ë¡œ ì»´íŒŒì¼ëŸ¬ëŠ” ê³ ìˆ˜ì¤€ ì–¸ì–´ë¥¼ ì €ìˆ˜ì¤€ ì–¸ì–´(ê¸°ê³„ì–´/ì–´ì…ˆë¸”ë¦¬ì–´ ë“±)ë¡œ ë³€í™˜í•˜ëŠ” ë³€í™˜ê¸°ë¥¼ ì¼ì»«ëŠ”ë‹¤. 
- JDK ë‚´ì—ëŠ” ìë°” ì–¸ì–´ë¡œ ì‘ì„±ëœ ì»´íŒŒì¼ëŸ¬ì¸ `javac`ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤. `javac`ë¡œ `java` íŒŒì¼ì„ JVMì´ ì´í•´í•˜ëŠ” `class` íŒŒì¼ë¡œ ì»´íŒŒì¼í•œë‹¤.

## ì‹¤í–‰í•˜ëŠ” ë°©ë²•
- `javac`ë¡œ ìë°”íŒŒì¼ì„ ì»´íŒŒì¼í•˜ê³ , `java`ë¡œ JVMìœ„ì— í”„ë¡œê·¸ë¨ì„ êµ¬ë™ì‹œí‚¨ë‹¤.
- ì˜ˆ) `javac Sample.java` -> `java Sample`

## ë°”ì´íŠ¸ì½”ë“œë€ ë¬´ì—‡ì¸ê°€
- ë°”ì´íŠ¸ì½”ë“œì— ëŒ€í•´ì„œëŠ” [Wikipedia](https://ko.wikipedia.org/wiki/%EB%B0%94%EC%9D%B4%ED%8A%B8%EC%BD%94%EB%93%9C)ì˜ ì„¤ëª…ì´ ì¢‹ì•„ì„œ ê°€ì ¸ì™€ë³´ì•˜ë‹¤.
> **ë°”ì´íŠ¸ì½”ë“œ(Bytecode, portable code, p-code)**ëŠ” íŠ¹ì • í•˜ë“œì›¨ì–´ê°€ ì•„ë‹Œ ê°€ìƒ ì»´í“¨í„°ì—ì„œ ëŒì•„ê°€ëŠ” ì‹¤í–‰ í”„ë¡œê·¸ë¨ì„ ìœ„í•œ ì´ì§„ í‘œí˜„ë²•ì´ë‹¤. í•˜ë“œì›¨ì–´ê°€ ì•„ë‹Œ ì†Œí”„íŠ¸ì›¨ì–´ì— ì˜í•´ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì—, ë³´í†µ ê¸°ê³„ì–´ë³´ë‹¤ ë” ì¶”ìƒì ì´ë‹¤.
ì—­ì‚¬ì ìœ¼ë¡œ ë°”ì´íŠ¸ì½”ë“œëŠ” ëŒ€ë¶€ë¶„ì˜ ëª…ë ¹ ì§‘í•©ì´ 0ê°œ ì´ìƒì˜ ë§¤ê°œ ë³€ìˆ˜ë¥¼ ê°–ëŠ” 1ë°”ì´íŠ¸ í¬ê¸°ì˜ ëª…ë ¹ ì½”ë“œ(opcode)ì˜€ê¸° ë•Œë¬¸ì— ë°”ì´íŠ¸ì½”ë“œë¼ ë¶ˆë¦¬ê²Œ ë˜ì—ˆë‹¤. ë°”ì´íŠ¸ì½”ë“œëŠ” íŠ¹ì • í•˜ë“œì›¨ì–´ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ì¤„ì´ê³ , ì¸í„°í”„ë¦¬íŒ…ë„ ì‰¬ìš´ ê²°ê³¼ë¬¼ì„ ìƒì„±í•˜ê³ ì í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì— ì˜í•´, ì¶œë ¥ ì½”ë“œì˜ í•œ í˜•íƒœë¡œ ì‚¬ìš©ëœë‹¤. ì»´íŒŒì¼ë˜ì–´ ë§Œë“¤ì–´ì§„ ë°”ì´íŠ¸ì½”ë“œëŠ” íŠ¹ì • í•˜ë“œì›¨ì–´ì˜ ê¸°ê³„ ì½”ë“œë¥¼ ë§Œë“œëŠ” ì»´íŒŒì¼ëŸ¬ì˜ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©ë˜ê±°ë‚˜, ê°€ìƒ ì»´í“¨í„°ì—ì„œ ë°”ë¡œ ì‹¤í–‰ëœë‹¤.
- ìë°”ì—ì„œëŠ” `class` íŒŒì¼ì´ ë°”ì´íŠ¸ì½”ë“œë¡œ ì‘ì„±ë˜ì–´ìˆê³ , JVMì€ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì½ëŠ”ë‹¤. 
- ê¸°ê³„ì–´ê°€ ì•„ë‹Œ ì¤‘ê°„ë‹¨ê³„ì˜ ì½”ë“œì´ë‹¤. 

## JIT ì»´íŒŒì¼ëŸ¬ë€ ë¬´ì—‡ì´ë©° ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€
- í”„ë¡œê·¸ë¨ì€ ê²°êµ­ í•˜ë“œì›¨ì–´ì—ì„œ ë™ì‘í•˜ê¸° ìœ„í•´ 'ê¸°ê³„ì–´'ë¡œ ë³€í™˜ë˜ì–´ì•¼ í•œë‹¤.
- JIT(Just In Time) ì»´íŒŒì¼ì€, í”„ë¡œê·¸ë¨ì„ ì‹¤ì œ ì‹¤í–‰í•˜ëŠ” ì‹œì ì— ê¸°ê³„ì–´ë¡œ ë²ˆì—­í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤. 
- ìë°”ì—ì„œëŠ” ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬ì¸ `javac`ì— ì˜í•´ `class`ë¡œ ë³€í™˜í•˜ê³ , JIT ì»´íŒŒì¼ëŸ¬ëŠ” ë°”ì´íŠ¸ì½”ë“œë¥¼ ì½ì–´ ê¸°ê³„ì–´ë¥¼ ìƒì„±í•œë‹¤. 

> ì „í†µì ì¸ ì…ì¥ì—ì„œ ì»´í“¨í„° í”„ë¡œê·¸ë¨ì„ ë§Œë“œëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆëŠ”ë°, **ì¸í„°í”„ë¦¬íŠ¸ ë°©ì‹**ê³¼ **ì •ì  ì»´íŒŒì¼** ë°©ì‹ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤. ì´ ì¤‘ ì¸í„°í”„ë¦¬íŠ¸ ë°©ì‹ì€ ì‹¤í–‰ ì¤‘ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ì½ì–´ê°€ë©´ì„œ í•´ë‹¹ ê¸°ëŠ¥ì— ëŒ€ì‘í•˜ëŠ” ê¸°ê³„ì–´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©°, ë°˜ë©´ ì •ì  ì»´íŒŒì¼ì€ ì‹¤í–‰í•˜ê¸° ì „ì— í”„ë¡œê·¸ë¨ ì½”ë“œë¥¼ ê¸°ê³„ì–´ë¡œ ë²ˆì—­í•œë‹¤.
*JIT ì»´íŒŒì¼ëŸ¬ëŠ” ë‘ ê°€ì§€ì˜ ë°©ì‹ì„ í˜¼í•©í•œ ë°©ì‹*ìœ¼ë¡œ ìƒê°í•  ìˆ˜ ìˆëŠ”ë°, ì‹¤í–‰ ì‹œì ì—ì„œ ì¸í„°í”„ë¦¬íŠ¸ ë°©ì‹ìœ¼ë¡œ ê¸°ê³„ì–´ ì½”ë“œë¥¼ ìƒì„±í•˜ë©´ì„œ ê·¸ ì½”ë“œë¥¼ ìºì‹±í•˜ì—¬, ê°™ì€ í•¨ìˆ˜ê°€ ì—¬ëŸ¬ ë²ˆ ë¶ˆë¦´ ë•Œ ë§¤ë²ˆ ê¸°ê³„ì–´ ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ë°©ì§€í•œë‹¤. *(ì¶œì²˜ : https://ko.wikipedia.org/wiki/JIT_%EC%BB%B4%ED%8C%8C%EC%9D%BC)*

## JVM êµ¬ì„± ìš”ì†Œ
![JVM êµ¬ì¡°](https://upload.wikimedia.org/wikipedia/commons/d/dd/JvmSpec7.png)
- [ê³µì‹ ë¬¸ì„œ](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html)ì— ë”°ë¥´ë©´, JVM êµ¬í˜„ìŠ¤í™ì€ `class` íŒŒì¼ë§Œ ì˜¬ë°”ë¥´ê²Œ ì½ìœ¼ë©´ ëœë‹¤ê³  í•œë‹¤. ì¡°ê¸ˆ ì¶©ê²©ì ì´ì§€ë§Œ, ë©”ëª¨ë¦¬ ê´€ë¦¬ ê¸°ìˆ  ë“±ì€ ì‚¬ì‹¤ JVMì˜ ìŠ¤í™ì´ ì•„ë‹ˆë‹¤. 
> To implement the Java Virtual Machine correctly, you need only be able to read the class file format and correctly perform the operations specified therein. Implementation details that are not part of the Java Virtual Machine's specification would unnecessarily constrain the creativity of implementors. For example, the memory layout of run-time data areas, the garbage-collection algorithm used, and any internal optimization of the Java Virtual Machine instructions (for example, translating them into machine code) are left to the discretion of the implementor.
<br>
JVMì€ ì‚¬ì‹¤ `class` íŒŒì¼ í˜•ì‹ë§Œ ì˜¬ë°”ë¥´ê²Œ ì½ë„ë¡ êµ¬í˜„í•˜ë©´ ëœë‹¤. ì´ë¥¼ í…Œë©´ ë©”ëª¨ë¦¬ êµ¬ì¡°ë‚˜ GC ì•Œê³ ë¦¬ì¦˜ì€ ì‚¬ì‹¤ JVMì˜ ìŠ¤í™ì´ ì•„ë‹ˆë‹¤.()
- ê³µì‹ë¬¸ì„œì—ì„œëŠ” JVMì˜ êµ¬ì¡°ë³´ë‹¤ ë°”ì´íŠ¸ì½”ë“œì¸ `class` íŒŒì¼ì˜ êµ¬ì„±ìš”ì†Œì— ì¢€ ë” ì§‘ì¤‘ë˜ì–´ìˆì–´ì„œ [Dzone JVM architecture](https://dzone.com/articles/jvm-architecture-explained)ë¥¼ ì°¸ê³ í–ˆë‹¤. 

### ClassLoader
- ì»´íŒŒì¼ ì‹œì ì´ ì•„ë‹Œ ì‹¤í–‰ ì‹œì ì— í´ë˜ìŠ¤ íŒŒì¼ì„ ì½ëŠ”ë‹¤.
- BootStrap(`rt.jar`) -> Extension(`~/jre/lib`) -> Application(ì†ŒìŠ¤ì½”ë“œ) ì˜ ìˆœì„œë¡œ ì½ëŠ”ë‹¤.
- ë°”ì´íŠ¸ì½”ë“œë¥¼ ì½ê³  `static` ë³€ìˆ˜ë¥¼ ë©”ëª¨ë¦¬ì— í• ë‹¹í•œë‹¤. 

### Runtime Data Area
- ë°ì´í„°ëŠ” í¬ê²Œ **Method, Heap, Stack, PC Registers, Native Method** 5ê°€ì§€ ì˜ì—­ì— ì €ì¥ëœë‹¤. 
- Method Area : í´ë˜ìŠ¤ ë ˆë²¨ì˜ ë°ì´í„°ê°€ ì €ì¥ëœë‹¤. í•˜ë‚˜ì˜ JVMì— í•˜ë‚˜ë§Œ ì¡´ì¬í•˜ë©°, ê³µìœ ëœë‹¤. 
- Heap Area : ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ê°€ ì €ì¥ëœë‹¤. í•˜ë‚˜ì˜ JVMì—ëŠ” í™ ì˜ì—­ë„ í•˜ë‚˜ë§Œ ì¡´ì¬í•œë‹¤. ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê³µìœ í•˜ëŠ” ê³µê°„ì´ë‹¤. ê¸°ë³¸ì ìœ¼ë¡œëŠ” thread-safe í•˜ì§€ ì•Šì€ ê³µê°„ì´ë‹¤.
- Stack Area : í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œ ë‹¨ìœ„ë¡œ ìƒê¸°ëŠ” ê³µê°„ì´ë‹¤. ì§€ì—­ë³€ìˆ˜ê°€ ì €ì¥ë˜ë©° thread-safeí•˜ë‹¤. 
- PC Registers : ê° ìŠ¤ë ˆë“œì˜ í˜„ì¬ ì‹¤í–‰ì‹œì ì´ ì €ì¥ë˜ëŠ” ê³µê°„ì´ë‹¤. í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œ ë‹¹ ê°œë³„ ê³µê°„ì„ ê°€ì§„ë‹¤.
- Native Method stacks : ê° ìŠ¤ë ˆë“œë§ˆë‹¤ native methodë¥¼ ì €ì¥í•˜ëŠ” ê³µê°„ì´ë‹¤.

### Execution Engine
#### JIT Compiler
- ë°”ì´íŠ¸ì½”ë“œëŠ” JIT Compilerì— ì˜í•´ ëŸ°íƒ€ì„ ì‹œì ì— ê¸°ê³„ì–´ë¡œ í•œë²ˆì— ë³€í™˜ë˜ì–´ ì‹¤í–‰ëœë‹¤.

#### GC
- JVMì˜ ë©”ëª¨ë¦¬ë¥¼ ì •ë¦¬í•´ì¤€ë‹¤. ì°¸ì¡°ë¥¼ ìƒì€ ë©”ëª¨ë¦¬ ì˜ì—­ì„ ì§€ìš°ê³ , ìƒˆ ì£¼ì†Œë¥¼ í• ë‹¹í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤. 

## JDKì™€ JREì˜ ì°¨ì´
### JRE
- Java Runtime Environment
- JVMì´ ìë°” í”„ë¡œê·¸ë¨ì„ ë™ì‘ì‹œí‚¬ ë•Œ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±ì„ ê°€ì§€ê³  ìˆìŒ.

### JDK
- Java Development Kit
- ìë°” í”„ë¡œê·¸ë¨ ê°œë°œì„ ìœ„í•´ í•„ìš”í•œ ê²ƒë“¤ì„ í¬í•¨í•˜ê³ ìˆë‹¤. ë°”ì´íŠ¸ì½”ë“œ ì»´íŒŒì¼ëŸ¬ì¸ `javac`ë¥¼ í¬í•¨í•˜ì—¬ JVMì„ êµ¬ë™í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±ì„ í¬í•¨í•œë‹¤.
- JDKëŠ” JREë¥¼ í¬í•¨í•˜ê³  ìˆë‹¤. 

