---
layout: post
title: "What is 'LANG=c'?"
author: "Hongmin Park"
---

한글이 깨져서 안보이거나, 한글이 깨질 것 같거나 여하튼 한글때문에 뭔가 불안하면 가장 쉬운 방법은 한글을 안쓰면된다.<br>
그러면 모든 고민들이 사라진다. Peace..<br>
하지만, 그렇지 않을때도 있다. 우리는 한국인이니까 ... <br><br>

---글넣기---

### LANG 변수란?
유닉스 계열에서 LANG 변수는 locale에 속한 모든 환경변수를 설정하는 환경변수이다.
### locale 이란? 
ocale은 언어, 국가, 인코딩 등을 지정하는 변수들의 set이라고 생각할 수 있다.<br>
즉, locale을 변경하면 리눅스 시스템 전체에 시간/날짜의 포맷, 한 주의 첫번째 날, 숫자 등 여러 포맷이 변경될 수 있다. 
<br>
정의에 따르면, `LANG=C`라는 명령어는 역시 로케일 값을 C로 설정하는 것인데, 그럼 C는 무슨 로케일 인것인가?<br>
C역시 로케일인데, 아무 로케일도 설정하지 않았을 때에 glibc에서의 기본 로케일, 또는 **POSIX** 로케일이라 하기도 한다고 한다. <br>
POSIX locale을 사용하면 unicode가 아닌 ascii코드 베이스이며, 이말인 즉슨 한글은 애초에 지원할 수가 없는 포맷이 된다는 것이다. (물론 영어는 아무 문제 없을 것이다.)
<br><br>
다시 본론으로 돌아가보자. 나는 putty로 ssh 접속 후 쉘에서 한글이 깨진 것 같았을 때에
(깨졌기 때문에 무슨 문자가 깨졌는지 사실 모르지만, 직감적으로 그것은 한국어였을 것이다) 습관적으로 `LANG=c`를 쳤다.~~(어깨너머로 배운 사수님의 커맨드)~~
<br>
`LANG=c`를 치면 대부분의 경우 영어로 내가 원하는 결과가 보였다. 그런데 곰곰히 생각해보면, vi 에디터로 파일을 열었을 때에 파일 내에서 인코딩이 깨진 경우에는, 
vi를 나가서 `LANG=C`를 쳐도 여전히 인코딩은 깨져있었던 것 같다. <br>
정리해보면, OS에서 `ls`, `date` 등 커맨드의 아웃풋 인코딩이 깨져서 `LANG=c`를 친 후에 다시 커맨드를 날리면 아웃풋이 정상(영어)로 보였고,<br>
특정 파일을 열어보았을 때에 인코딩이 깨져있는 경우, 파일명의 인코딩이 깨진 경우에는 `LANG=c`를 해도 여전히 깨져있었다.<br>
**즉,** 이미 한글을 지원하는 인코딩방식(아마도 UTF-8)으로 된 파일, 글자 등의 경우에는 OS에서 인코딩이 깨진 것이 아니라 putty에서 한글인코딩이 OS 한글인코딩과 맞지 않아서 생긴 일인 것이다. <br>
이 경우에는, OS인코딩 값과 Putty 인코딩 값을 맞추어야 아마도 한글이 정상적으로 보였을 것이다.<br>
또, `LANG=c`로 커맨드를 날렸을 때에 putty가 한글지원을 하지 않아서 한글이 안보였던 것이고, LANG=c로 기본 로케일로 설정하면 당연히 인코딩이 깨지지 않고 영어로 보였던 것이다.
<br><br>
이번 일을 계기로 OS에서 `LANG=c` 를 쳤을 때에 일어나는 일을 머리에 잘 정리하게 되었는데, WAS 운영자의 입장에서 본능적으로 jvm-option으로 설정하는 enconding 중요성에 대해서도 실감하게 되었다.<br>
내가 잘못 기동한 이 서버의 경우, jvm을 기동하는 계정의 `.bash_profile`에 `LANG=ko_KR.UTF-8`이라고 설정되어 있었고, jvm-option에는 `-Dfile.encoding=UTF-8` 이 값이 없었다.<br>
jvm-option에서 설정한 값이 없으면 jvm은 어플리케이션의 입출력 인코딩을 시스템 기본으로 가져가게 된다. 운영중인 이 서버는 기존에 jvm을 기동하는 계정 `.bash_profile`에 로케일 값을 설정해두었기 
때문에 한글 인코딩을 지원하는 `ko_KR.UTF-8` 입출력을 기대하였으나, 내가 `LANG=C`로 잠깐 내 세션의 로케일 값으 변경한 후에 jvm을 기동해버려서 한글을 지원하지 않는 기본 로케일 값으로 jvm이 구동된 것이다.<br>
<br>
어플리케이션에서 한글이 필요하면 jvm-option에 `-Dfile.encoding=UTF-8` 이걸 넣자. <br>
설정은 항상최상위로 먹힐 수 있도록, 제일 상위에 하는 생각을 들이자. <br>

~~(하지만 여전히 인코딩은 어렵다...)~~


